/*
Created By:    Zachary Ordo
Created Date:  2021-08-05
Last Modified: 2022-02-18

This job builds the Main Analog History table for the Clearfork Plant.
*/

SET NOCOUNT ON
DECLARE @StartDate DateTime
DECLARE @EndDate DateTime
SET @StartDate = '08/31/2020 11:01'
SET @EndDate = DATEADD(dd,1,CONVERT(datetime,CONVERT(date,GetDate())))+CAST('11:01:00' AS DATETIME)
SET NOCOUNT OFF
INSERT INTO [GISViews].[dbo].[CFHISSVR02AnalogHisMain] (TagName, ShortTagName, DisplayTagName, Description, StartDateTime, DateTime, ActualDate, ActualYear, ActualQuarter, ActualMonth, ActualMonthNumber, ActualDay, Value, vValue, displayValue, Units, SimpleUnits)
	SELECT  * FROM (
	SELECT TagName, SUBSTRING(TagName,1,9) AS ShortTagName, 'FT-' + SUBSTRING(TagName, 5, 5) AS DisplayTagName,
		CASE TagName
			WHEN 'C6100_Data\DiscPrs' THEN '(C6100_Data\DiscPrs) C6100_Data\DiscPrs'
			WHEN 'C6100_Data\SucPres' THEN '(C6100_Data\SucPres) C6100_Data\SucPrs'
			WHEN 'EXP_FI_110' THEN '(EXP_FI_110) Compressor Inlet Volumertric Flow Rate'
			WHEN 'EXP_FIC_110' THEN '(EXP_FIC_110) Compressor Surge Control Output'
			WHEN 'EXP_PDAH_105' THEN '(EXP_PDAH_105) Expander Thrust High DP Alarm'
			WHEN 'EXP_PDI_101' THEN '(EXP_PDI_101) Seal Gas Diff Pressure'
			WHEN 'EXP_PDI_104' THEN '(EXP_PDI_104) Compressor Thrust Diff Pressure'
			WHEN 'EXP_PDI_105' THEN '(EXP_PDI_105) Expander Thrust Diff Pressure'
			WHEN 'EXP_PDI_110' THEN '(EXP_PDI_110) Compressor Inlet Flow Diff Pressure'
			WHEN 'EXP_PI_101' THEN '(EXP_PI_101) Expander Wheel Pressure'
			WHEN 'EXP_PI_103' THEN '(EXP_PI_103) Compressor Wheel Pressure'
			WHEN 'EXP_PI_109' THEN '(EXP_PI_109) Compressor Inlet Pressure'
			WHEN 'EXP_SI_101' THEN '(EXP_SI_101) Expander/Compressor Speed'
			WHEN 'EXP_ZI_101' THEN '(EXP_ZI_101) IGV Postion'
			WHEN 'FFIC-1222\PV' THEN '(FFIC-1222\PV) FFIC-1222 Process Variable'
			WHEN 'FFIC-1438\PV' THEN '(FFIC-1438\PV) FFIC-1438 Process Variable'
			WHEN 'FIT-1045A\PV' THEN '(FIT-1045A\PV) Inlet Meter Run Flow'
			WHEN 'FIT-8000A\PV' THEN '(FIT-8000A\PV) NGL Metering/Plant Outlet Flow'
			WHEN 'FIT-8210A\PV' THEN '(FIT-8210A\PV) Residue Meter Flow'
			WHEN 'FQI-1045A_PrevDay' THEN '(FT-1045A) Site Inlet Meter Run Flow'
			WHEN 'FQI-1400A_PrevDay' THEN '(FT-1400A) Plant 1 Inlet Gas Meter Flow'
			WHEN 'FQI-7105A\PV' THEN '(FQI-7105A\PV) Hot Oil Heater Fuel Gas Flow Total'
			WHEN 'FQI-8000A_PrevDay' THEN '(FT-8000A) Plant 1 Liquids Production'
			WHEN 'FQI-8210A_PrevDay' THEN '(FT-8210A) Plant 1 Residue Gas Outlet'
			WHEN 'FQI-8220B_PrevDay' THEN '(FT-8220B) Fuel Gas Header Flow'
			WHEN 'FQI-9000A_PrevDay' THEN '(FT-9000A) Plant 1 Fuel Gas Header to Flare Flow'
			WHEN 'FQI-9110A_PrevDay' THEN '(FT-9110A) Flare Inlet Flow'
			WHEN 'FT1222_CMP\PV' THEN '(FT1222_CMP\PV) FT1222_CMP\PV'
			WHEN 'FT-1421A\PV' THEN '(FT-1421A\PV) V-1421 Cold Separator Liquid Level Rejection Outle'
			WHEN 'FT1438_CMP\PV' THEN '(FT1438_CMP\PV) FT1438_CMP\PV'
			WHEN 'GC1_INLET_BTU' THEN '(GC1_INLET_BTU) Inlet BTU/SCF'
			WHEN 'GC1_INLET_C1' THEN '(GC1_INLET_C1) Inlet C1'
			WHEN 'GC1_INLET_C2' THEN '(GC1_INLET_C2) Inlet C2'
			WHEN 'GC1_INLET_C3' THEN '(GC1_INLET_C3) Inlet C3'
			WHEN 'GC1_INLET_C6_PLUS' THEN '(GC1_INLET_C6_PLUS) Inlet C6+'
			WHEN 'GC1_INLET_CO2' THEN '(GC1_INLET_CO2) Inlet C02'
			WHEN 'GC1_INLET_IC4' THEN '(GC1_INLET_IC4) Inlet IC4'
			WHEN 'GC1_INLET_IC5' THEN '(GC1_INLET_IC5) Inlet IC5'
			WHEN 'GC1_INLET_N2' THEN '(GC1_INLET_N2) Inlet N2'
			WHEN 'GC1_INLET_NC4' THEN '(GC1_INLET_NC4) Inlet NC4'
			WHEN 'GC1_INLET_NC5' THEN '(GC1_INLET_NC5) Inlet NC5'
			WHEN 'GC1_RESIDUE_BTU' THEN '(GC1_RESIDUE_BTU) Residue BTU/SCF'
			WHEN 'GC1_RESIDUE_C1' THEN '(GC1_RESIDUE_C1) Residue C1'
			WHEN 'GC1_RESIDUE_C2' THEN '(GC1_RESIDUE_C2) Residue C2'
			WHEN 'GC1_RESIDUE_C3' THEN '(GC1_RESIDUE_C3) Residue C3'
			WHEN 'GC1_RESIDUE_CO2' THEN '(GC1_RESIDUE_CO2) Residue C02'
			WHEN 'GC1_RESIDUE_IC4' THEN '(GC1_RESIDUE_IC4) Residue IC4'
			WHEN 'GC1_RESIDUE_IC5' THEN '(GC1_RESIDUE_IC5) Residue IC5'
			WHEN 'GC1_RESIDUE_N2' THEN '(GC1_RESIDUE_N2) Residue N2'
			WHEN 'GC1_RESIDUE_NC4' THEN '(GC1_RESIDUE_NC4) Residue NC4'
			WHEN 'GC1_RESIDUE_NC5' THEN '(GC1_RESIDUE_NC5) Residue NC5'
			WHEN 'GC2_YGRADE_C2_LIQ_VOL' THEN '(GC2_YGRADE_C2_LIQ_VOL) YGRADE C2 Liquid Volume %'
			WHEN 'GC2_YGRADE_C2C3_RATIO' THEN '(GC2_YGRADE_C2C3_RATIO) YGRADE C2/C3 Ratio'
			WHEN 'GC2_YGRADE_C3' THEN '(GC2_YGRADE_C3) YGRADE C3'
			WHEN 'GC2_YGRADE_C6_PLUS' THEN '(GC2_YGRADE_C6_PLUS) YGRADE C6+'
			WHEN 'GC2_YGRADE_IC4' THEN '(GC2_YGRADE_IC4) YGRADE IC4'
			WHEN 'GC2_YGRADE_IC5' THEN '(GC2_YGRADE_IC5) YGRADE IC5'
			WHEN 'GC2_YGRADE_NC4' THEN '(GC2_YGRADE_NC4) YGRADE NC4'
			WHEN 'GC2_YGRADE_NC5' THEN '(GC2_YGRADE_NC5) YGRADE NC5'
			WHEN 'PIC-1421\SO' THEN '(PIC-1421\SO) PIC-1421 Set Output'
			WHEN 'PIC-6050A\SO' THEN '(PIC-6050A\SO) PIC-6050A Set Output'
			WHEN 'PIC-6050B\SO' THEN '(PIC-6050B\SO) PIC-6050B Set Output'
			WHEN 'PIT-6050C\PV' THEN '(PIT-6050C\PV) Residue Gas Header Pressure'
			WHEN 'PIT-8210A\PV' THEN '(PIT-8210A\PV) Residue Meter Pressure'
			WHEN 'PT-1121A\PV' THEN '(PT-1121A\PV) C-1121 Compressor Inlet Pressure'
			WHEN 'PT-1121B\PV' THEN '(PT-1121B\PV) EX-1121 Expander Inlet Pressure'
			WHEN 'PT-1121C\PV' THEN '(PT-1121C\PV) C-1121 Compressor Outlet Pressure'
			WHEN 'PT-1121D\PV' THEN '(PT-1121D\PV) EX-1121 Expander Outlet Pressure'
			WHEN 'PT-1121E\PV' THEN '(PT-1121E\PV) C-1121 Compressor Inlet Pressure Control Pressure'
			WHEN 'PT-1321\PV' THEN '(PT-1321\PV) A-1321 Expander/Compressor Discharge Cooler Outlet'
			WHEN 'PT-1416\PV' THEN '(PT-1416\PV) Dehy Dust Filter Inlet Pressure'
			WHEN 'PT-1421\PV' THEN '(PT-1421\PV) V-1421 Cold Separator Outlet Pressure'
			WHEN 'PT-1438A\PV' THEN '(PT-1438A\PV) RSV Gas Pressure'
			WHEN 'PT-1521A\PV' THEN '(PT-1521A\PV) T-1521 Demethanizer Tower Outlet Pressure'
			WHEN 'PT-1521D\PV' THEN '(PT-1521D\PV) T-1521 Demethanizer Tower Vapor Pressure'
			WHEN 'TE-1121\PV' THEN '(TE-1121\PV) C-1121 Compressor Inlet Temperature'
			WHEN 'TE-1121C\PV' THEN '(TE-1121C\PV) C-1121 Compressor Outlet Temperature'
			WHEN 'TE-1121D\PV' THEN '(TE-1121D\PV) EX-1121 Expander Outlet Temperature'
			WHEN 'TE-1221A\PV' THEN '(TE-1221A\PV) E-1221/222 Exchanger Gas Side Outlet Temperature'
			WHEN 'TE-1221B\PV' THEN '(TE-1221B\PV) E-1221 Gas Exchanger Process Outlet Temperature'
			WHEN 'TE-1221F\PV' THEN '(TE-1221F\PV) RSV Gas to E221 Temperature'
			WHEN 'TE-1222A\PV' THEN '(TE-1222A\PV) E-1221/222 Exchanger Gas Side Inlet Temperature'
			WHEN 'TE-1222C\PV' THEN '(TE-1222C\PV) E-1222 Reflux Condensor Outlet Temperature'
			WHEN 'TE-1222D\PV' THEN '(TE-1222D\PV) Ortloff Valve Outlet Temperature'
			WHEN 'TE-1222J\PV' THEN '(TE-1222J\PV) RSV Gas from E222 Temperature'
			WHEN 'TE-1222K\PV' THEN '(TE-1222K\PV) RSV Gas from FCV222 Temperature'
			WHEN 'TE-1223A\PV' THEN '(TE-1223A\PV) E-1223 Demethanizer Reboiler Gas Inlet Temperature'
			WHEN 'TE-1224A\PV' THEN '(TE-1224A\PV) E-1224 Demethanizer Side Reboiler Inlet Temp'
			WHEN 'TE-1224B\PV' THEN '(TE-1224B\PV) E-1224 Demethanizer Side Reboiler Outlet Temp'
			WHEN 'TE-1224C\PV' THEN '(TE-1224C\PV) E-1223/224 Demethanizer Reboiler Gas Side Outlet T'
			WHEN 'TE-1225D\PV' THEN '(TE-1225D\PV) E-1225 Trim Reboiler Outlet Temperature'
			WHEN 'TE-1241A\PV' THEN '(TE-1241A\PV) E-1241 Gas Chiller Process Side Inlet Temperature'
			WHEN 'TE-1321\PV' THEN '(TE-1321\PV) A-1321 Expander/Compressor Discharge Cooler Outlet'
			WHEN 'TE-1421\PV' THEN '(TE-1421\PV) V-1421 Cold Separator Outlet Temperature'
			WHEN 'TE-1521F\PV' THEN '(TE-1521F\PV) DeMethanizer Tower Bottoms Temperature'
			WHEN 'TIC-1421\PV' THEN '(TIC-1421\PV) TIC-1421 Process Variable'
			WHEN 'TIT-8210A\PV' THEN '(TIT-8210A\PV) Residue Meter Temperature'
		END AS Description,
		StartDateTime, DateTime, 
		CONVERT(date, DateTime) as ActualDate,
		YEAR(CONVERT(date, DateTime)) as ActualYear,
		DATENAME(quarter, CONVERT(date, DateTime)) as ActualQuarter,
		DATENAME(month, CONVERT(date, DateTime)) as ActualMonth,
		MONTH(CONVERT(date, DateTime)) as ActualMonthNumber,
		DAY(CONVERT(date, DateTime)) as ActualDay,
		Value, vValue,
		CASE TagName
			WHEN 'FQI-9000A_PrevDay' THEN (24*Value/1000000)
			ELSE Value
		END AS displayValue,
		CASE TagName
			WHEN 'FQI-1045A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-1400A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-8000A_PrevDay' THEN 'Production (gals)'
			WHEN 'FQI-8210A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-8220B_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-9000A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-9110A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'GC1_INLET_BTU' THEN 'BTU'
			WHEN 'GC1_INLET_C1' THEN '%'
			WHEN 'GC1_INLET_C2' THEN '%'
			WHEN 'GC1_INLET_C3' THEN '%'
			WHEN 'GC1_INLET_C6_PLUS' THEN '%'
			WHEN 'GC1_INLET_CO2' THEN '%'
			WHEN 'GC1_INLET_IC4' THEN '%'
			WHEN 'GC1_INLET_IC5' THEN '%'
			WHEN 'GC1_INLET_N2' THEN '%'
			WHEN 'GC1_INLET_NC4' THEN '%'
			WHEN 'GC1_INLET_NC5' THEN '%'
			WHEN 'GC1_RESIDUE_BTU' THEN '%'
			WHEN 'GC1_RESIDUE_C1' THEN '%'
			WHEN 'GC1_RESIDUE_C2' THEN '%'
			WHEN 'GC1_RESIDUE_C3' THEN '%'
			WHEN 'GC1_RESIDUE_CO2' THEN '%'
			WHEN 'GC1_RESIDUE_IC4' THEN '%'
			WHEN 'GC1_RESIDUE_IC5' THEN '%'
			WHEN 'GC1_RESIDUE_N2' THEN '%'
			WHEN 'GC1_RESIDUE_NC4' THEN '%'
			WHEN 'GC1_RESIDUE_NC5' THEN '%'
			WHEN 'GC2_YGRADE_C2_LIQ_VOL' THEN '%'
			WHEN 'GC2_YGRADE_C2C3_RATIO' THEN '%'
			WHEN 'GC2_YGRADE_C3' THEN '%'
			WHEN 'GC2_YGRADE_C6_PLUS' THEN '%'
			WHEN 'GC2_YGRADE_IC4' THEN '%'
			WHEN 'GC2_YGRADE_IC5' THEN '%'
			WHEN 'GC2_YGRADE_NC4' THEN '%'
			WHEN 'GC2_YGRADE_NC5' THEN '%'
			WHEN 'TE-1121\PV' THEN '°F'
			WHEN 'TE-1121C\PV' THEN '°F'
			WHEN 'TE-1121D\PV' THEN '°F'
			WHEN 'TE-1221A\PV' THEN '°F'
			WHEN 'TE-1221B\PV' THEN '°F'
			WHEN 'TE-1221F\PV' THEN '°F'
			WHEN 'TE-1222A\PV' THEN '°F'
			WHEN 'TE-1222C\PV' THEN '°F'
			WHEN 'TE-1222D\PV' THEN '°F'
			WHEN 'TE-1222J\PV' THEN '°F'
			WHEN 'TE-1222K\PV' THEN '°F'
			WHEN 'TE-1223A\PV' THEN '°F'
			WHEN 'TE-1224A\PV' THEN '°F'
			WHEN 'TE-1224B\PV' THEN '°F'
			WHEN 'TE-1224C\PV' THEN '°F'
			WHEN 'TE-1225D\PV' THEN '°F'
			WHEN 'TE-1241A\PV' THEN '°F'
			WHEN 'TE-1321\PV' THEN '°F'
			WHEN 'TE-1421\PV' THEN '°F'
			WHEN 'TE-1521F\PV' THEN '°F'
			WHEN 'TIT-8210A\PV' THEN '°F'
			ELSE 'Unk'
		END AS Units,
		CASE TagName
			WHEN 'FQI-1045A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-1400A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-8000A_PrevDay' THEN 'Production (gals)'
			WHEN 'FQI-8210A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-8220B_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-9000A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'FQI-9110A_PrevDay' THEN 'Avg Flow (mmscf)'
			WHEN 'GC1_INLET_BTU' THEN 'BTU'
			WHEN 'GC1_INLET_C1' THEN '%'
			WHEN 'GC1_INLET_C2' THEN '%'
			WHEN 'GC1_INLET_C3' THEN '%'
			WHEN 'GC1_INLET_C6_PLUS' THEN '%'
			WHEN 'GC1_INLET_CO2' THEN '%'
			WHEN 'GC1_INLET_IC4' THEN '%'
			WHEN 'GC1_INLET_IC5' THEN '%'
			WHEN 'GC1_INLET_N2' THEN '%'
			WHEN 'GC1_INLET_NC4' THEN '%'
			WHEN 'GC1_INLET_NC5' THEN '%'
			WHEN 'GC1_RESIDUE_BTU' THEN '%'
			WHEN 'GC1_RESIDUE_C1' THEN '%'
			WHEN 'GC1_RESIDUE_C2' THEN '%'
			WHEN 'GC1_RESIDUE_C3' THEN '%'
			WHEN 'GC1_RESIDUE_CO2' THEN '%'
			WHEN 'GC1_RESIDUE_IC4' THEN '%'
			WHEN 'GC1_RESIDUE_IC5' THEN '%'
			WHEN 'GC1_RESIDUE_N2' THEN '%'
			WHEN 'GC1_RESIDUE_NC4' THEN '%'
			WHEN 'GC1_RESIDUE_NC5' THEN '%'
			WHEN 'GC2_YGRADE_C2_LIQ_VOL' THEN '%'
			WHEN 'GC2_YGRADE_C2C3_RATIO' THEN '%'
			WHEN 'GC2_YGRADE_C3' THEN '%'
			WHEN 'GC2_YGRADE_C6_PLUS' THEN '%'
			WHEN 'GC2_YGRADE_IC4' THEN '%'
			WHEN 'GC2_YGRADE_IC5' THEN '%'
			WHEN 'GC2_YGRADE_NC4' THEN '%'
			WHEN 'GC2_YGRADE_NC5' THEN '%'
			WHEN 'TE-1121\PV' THEN '°F'
			WHEN 'TE-1121C\PV' THEN '°F'
			WHEN 'TE-1121D\PV' THEN '°F'
			WHEN 'TE-1221A\PV' THEN '°F'
			WHEN 'TE-1221B\PV' THEN '°F'
			WHEN 'TE-1221F\PV' THEN '°F'
			WHEN 'TE-1222A\PV' THEN '°F'
			WHEN 'TE-1222C\PV' THEN '°F'
			WHEN 'TE-1222D\PV' THEN '°F'
			WHEN 'TE-1222J\PV' THEN '°F'
			WHEN 'TE-1222K\PV' THEN '°F'
			WHEN 'TE-1223A\PV' THEN '°F'
			WHEN 'TE-1224A\PV' THEN '°F'
			WHEN 'TE-1224B\PV' THEN '°F'
			WHEN 'TE-1224C\PV' THEN '°F'
			WHEN 'TE-1225D\PV' THEN '°F'
			WHEN 'TE-1241A\PV' THEN '°F'
			WHEN 'TE-1321\PV' THEN '°F'
			WHEN 'TE-1421\PV' THEN '°F'
			WHEN 'TE-1521F\PV' THEN '°F'
			WHEN 'TIT-8210A\PV' THEN '°F'
			ELSE 'Unk'
		END AS SimpleUnits
		FROM [CFHISSVR02].[Runtime].[dbo].[History]
		WHERE TagName IN ('C6100_Data\DiscPrs','C6100_Data\SucPres','EXP_FI_110','EXP_FIC_110','EXP_PDAH_105','EXP_PDI_101','EXP_PDI_104','EXP_PDI_105','EXP_PDI_110','EXP_PI_101','EXP_PI_103','EXP_PI_109','EXP_SI_101','EXP_ZI_101','FFIC-1222\PV','FFIC-1438\PV','FIT-1045A\PV','FIT-8000A\PV','FIT-8210A\PV','FQI-1045A_PrevDay', 'FQI-1400A_PrevDay','FQI-7105A\PV','FQI-8000A_PrevDay', 'FQI-8210A_PrevDay', 'FQI-9000A_PrevDay', 'FQI-9110A_PrevDay', 'FQI-8220B_PrevDay','FT1222_CMP\PV','FT-1421A\PV','FT1438_CMP\PV','GC1_INLET_BTU','GC1_INLET_C1','GC1_INLET_C2','GC1_INLET_C3','GC1_INLET_C6_PLUS','GC1_INLET_CO2','GC1_INLET_IC4','GC1_INLET_IC5','GC1_INLET_N2','GC1_INLET_NC4','GC1_INLET_NC5','GC1_RESIDUE_BTU','GC1_RESIDUE_C1','GC1_RESIDUE_C2','GC1_RESIDUE_C3','GC1_RESIDUE_CO2','GC1_RESIDUE_IC4','GC1_RESIDUE_IC5','GC1_RESIDUE_N2','GC1_RESIDUE_NC4','GC1_RESIDUE_NC5','GC2_YGRADE_C2_LIQ_VOL','GC2_YGRADE_C2C3_RATIO','GC2_YGRADE_C3','GC2_YGRADE_C6_PLUS','GC2_YGRADE_IC4','GC2_YGRADE_IC5','GC2_YGRADE_NC4','GC2_YGRADE_NC5','PIC-1421\SO','PIC-6050A\SO','PIC-6050B\SO','PIT-6050C\PV','PIT-8210A\PV','PT-1121A\PV','PT-1121B\PV','PT-1121C\PV','PT-1121D\PV','PT-1121E\PV','PT-1321\PV','PT-1416\PV','PT-1421\PV','PT-1438A\PV','PT-1521A\PV','PT-1521D\PV','TE-1121\PV','TE-1121C\PV','TE-1121D\PV','TE-1221A\PV','TE-1221B\PV','TE-1221F\PV','TE-1222A\PV','TE-1222C\PV','TE-1222D\PV','TE-1222J\PV','TE-1222K\PV','TE-1223A\PV','TE-1224A\PV','TE-1224B\PV','TE-1224C\PV','TE-1225D\PV','TE-1241A\PV','TE-1321\PV','TE-1421\PV','TE-1521F\PV','TIC-1421\PV','TIT-8210A\PV')
		AND wwRetrievalMode = 'Cyclic'
		AND wwResolution = 86400000
		AND wwQualityRule = 'Extended'
		AND wwVersion = 'Latest'
		AND DateTime >= @StartDate
		AND DateTime <= @EndDate) temp
	WHERE temp.StartDateTime >= @StartDate
	AND temp.ActualDate <> '09/14/2020'
	AND temp.Value IS NOT NULL;